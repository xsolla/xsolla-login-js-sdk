!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).XL=e()}}(function(){return function r(s,a,l){function c(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,r,s,a,l)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){t.exports=function(e){return o.test(e)?e.toLowerCase():i.test(e)?(n=e,n.replace(s,function(e,t){return t?" "+t:""})||e).toLowerCase():r.test(e)?(t=e,t.replace(a,function(e,t,n){return t+" "+n.toLowerCase().split("").join(" ")})).toLowerCase():e.toLowerCase();var t;var n};var o=/\s/,i=/(_|-|\.|:)/,r=/([a-z][A-Z]|[A-Z][a-z])/;var s=/[\W_]+(.|$)/g;var a=/(.)([A-Z]+)/g},{}],2:[function(e,t,n){var o=e("to-space-case");t.exports=function(e){return o(e).replace(/\s/g,"_")}},{"to-space-case":3}],3:[function(e,t,n){var o=e("to-no-case");t.exports=function(e){return o(e).replace(/[\W_]+(.|$)/g,function(e,t){return t?" "+t:""}).trim()}},{"to-no-case":1}],4:[function(e,t,n){t.exports={version:"2.2.4"}},{}],5:[function(e,t,n){"use strict";if(String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),"function"!=typeof window.CustomEvent){var o=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};o.prototype=window.Event.prototype,window.CustomEvent=o}},{}],6:[function(e,t,n){"use strict";var o=function(e,t){var i=this;this.baseUrl=t||"//login.xsolla.com/api/",this.projectId=e,this.makeApiCall=function(e,t,n){var o=new XMLHttpRequest;o.withCredentials=!0,o.open(e.method,i.baseUrl+e.endpoint,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?t(JSON.parse(o.responseText)):o.responseText?n(JSON.parse(o.responseText)):n({error:{message:"Networking error",code:o.status}}))},"POST"==e.method?(o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(e.postBody)):"GET"==e.method&&o.send(e.getArguments)}};o.prototype.getSocialsURLs=function(e,t,n){var o="";for(var i in n)""!=o&&(o+="&"),o+=i+"="+encodeURIComponent(n[i]);return this.makeApiCall({method:"GET",endpoint:"social/login_urls?"+o,getArguments:null},e,t)},o.prototype.loginPassAuth=function(e,t,n,o,i,r){var s={username:e,password:t,remember_me:n};return this.makeApiCall({method:"POST",endpoint:"proxy/login?projectId="+this.projectId+"&redirect_url="+encodeURIComponent(o),postBody:JSON.stringify(s)},i,r)},o.prototype.smsAuth=function(e,t,n){return this.makeApiCall({method:"GET",endpoint:"sms",getArguments:"phoneNumber="+e},t,n)},t.exports=o},{}],main:[function(e,t,n){"use strict";var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),s=e("./xlapi"),a=(o=s)&&o.__esModule?o:{default:o};var y=e("to-snake-case");e("./supports");var m=e("../package.json").version,l={LOGIN:"",REGISTRATION:"registration",RECOVER_PASSWORD:"reset-password",ALL_SOCIALS:"other",SOCIALS_LOGIN:"socials",USERNAME_LOGIN:"username-login"},w=["onlyWidgets","apiUrl","defaultLoginUrl","popupBackgroundColor","iframeZIndex","preloader","widgetBaseUrl","route","inFullscreenMode","redirectUrl","widgetVersion","projectId","callbackUrl","loginUrl","state"],c={apiUrl:"https://login.xsolla.com/api/",onlyWidgets:!1,defaultLoginUrl:"https://xl-widget.xsolla.com/auth.html",popupBackgroundColor:"rgb(187, 187, 187)",iframeZIndex:1e6,preloader:"<div></div>",widgetBaseUrl:"https://xl-widget.xsolla.com/",route:l.LOGIN,inFullscreenMode:!1,response_type:"code"},u="XsollaLoginWidgetIframe",d=document.createElement("iframe"),p=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socialUrls={},this.eventTypes={LOAD:"load",CLOSE:"close",HIDE_POPUP:"hide popup",REGISTRATION_REQUEST:"registration request",AUTHENTICATED:"authenticated"},this.ROUTES=l,this.dispatcher=document.createElement("div"),this.onHideEvent=this.onHideEvent.bind(this)}return r(e,[{key:"init",value:function(e){var n=this;this.config=i({},c,e),this.config.popupBackgroundColor=c.popupBackgroundColor,this.api=new a.default(e.projectId,this.config.apiUrl);var t=window.addEventListener?"addEventListener":"attachEvent";if((0,window[t])("attachEvent"===t?"onmessage":"message",function(e){var t=void 0;t="string"==typeof e.data?new CustomEvent(n.eventTypes[e.data]):new CustomEvent(n.eventTypes[e.data.type],{detail:e.data}),n.dispatcher.dispatchEvent(t)},!1),Object.keys(this.eventTypes).map(function(e){n.on(n.eventTypes[e])}),e.popupBackgroundColor&&(this.config.popupBackgroundColor=e.popupBackgroundColor),this.dispatcher.addEventListener(this.eventTypes.HIDE_POPUP,this.onHideEvent),!this.config.onlyWidgets){var o={};o.projectId=e.projectId,this.config.redirectUrl&&(o.redirect_url=this.config.redirectUrl),this.config.loginUrl&&(o.login_url=this.config.loginUrl),this.config.callbackUrl&&(o.login_url=this.config.callbackUrl)}}},{key:"login",value:function(e,n,o){var i=this;e&&this.socialUrls&&(e.authType&&(e.authType.startsWith("sn-")?null!=this.socialUrls[e.authType]?window.location.href=this.socialUrls[e.authType]:console.error("Auth type: "+e.authType+" doesn't exist"):"login-pass"==e.authType?this.api.loginPassAuth(e.login,e.pass,e.rememberMe,this.config.redirectUrl,function(e){if(e.login_url){var t=function(){window.location.href=e.login_url};o?o({status:"success",finish:t,redirectUrl:e.login_url}):t()}else n(i.createErrorObject("Login or pass not valid",2))},function(e){n(e)}):"sms"==e.authType?"phone"==smsAuthStep?this.api.smsAuth(e.phoneNumber,null,null):smsAuthStep:console.error("Unknown auth type")))}},{key:"createErrorObject",value:function(e,t){return{error:{message:e,code:t||-1}}}},{key:"getProjectId",value:function(){return this.config.projectId}},{key:"getRedirectURL",value:function(){return this.config.redirectUrl}},{key:"getTheme",value:function(){return this.config.theme}},{key:"getCallbackUrl",value:function(){return this.config.callbackUrl?this.config.callbackUrl:this.config.loginUrl?this.config.loginUrl:this.config.externalWindow?c.defaultLoginUrl:void 0}},{key:"getIframeSrc",value:function(){return this.getLink.apply(this,arguments)}},{key:"getLink",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.widgetBaseUrl||this.config.widgetBaseUrl;"/"!==t.substr(-1)&&(t+="/");var n=t+(e.route||this.config.route)+"?projectId="+encodeURIComponent(this.getProjectId())+"&widget_sdk_version="+m,o=!1,i=!0,r=!1,s=void 0;try{for(var a,l=Object.keys(this.config)[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var c=a.value;if(!w.includes(c)){var u=y(c);o||"client_id"!==u||(o=!0),n+="&"+u+"="+encodeURIComponent(this.config[c])}}}catch(e){r=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw s}}var d=this.getRedirectURL();d&&(n=n+"&redirectUrl="+encodeURIComponent(d));var p=this.getCallbackUrl();p&&(n=n+"&login_url="+encodeURIComponent(p));var h=this.config,f=h.externalWindow,g=h.state;f&&(n=n+"&external_window="+encodeURIComponent(f)),o&&(n+="&state="+encodeURIComponent(g||Math.random().toString(36).substring(2)));var v=this.config.widgetVersion;return v&&(n+="&version="+encodeURIComponent(v)),n}},{key:"AuthWidget",value:function(e,t){var n=this;if(this.api)if(e){null==t&&(t={});var o=(t.width||400)+"px",i=(t.height||550)+"px";d.onload=function(){s.removeChild(r),d.style.width="100%",d.style.height="100%";var e=new CustomEvent("load");n.dispatcher.dispatchEvent(e)},d.style.width=0,d.style.height=0,d.frameBorder="0",d.src=this.getIframeSrc(t),d.id=u;var r=document.createElement("div");r.innerHTML=this.config.preloader;var s=document.getElementById(e);s?(s.style.width=o,s.style.height=i,s.appendChild(r),s.appendChild(d)):console.error('Element "'+e+'" not found!')}else console.error("No div name!");else console.error("Please run XL.init() first")}},{key:"onCloseEvent",value:function(){d.parentNode.removeChild(d)}},{key:"_hide",value:function(){d.style.position="",d.style.zIndex="",d.style.left="",d.style.top="",d.style.width=0,d.style.height=0,d.style.backgroundColor=""}},{key:"onHideEvent",value:function(){this.config.inFullscreenMode&&this._hide()}},{key:"on",value:function(e,t){t=t||function(){},e===this.eventTypes.CLOSE&&(t?this.dispatcher.removeEventListener(e,this.onCloseEvent):t=this.onCloseEvent),this.dispatcher.addEventListener(e,function(e){return t(e.detail)})}},{key:"_show",value:function(){d.style.position="fixed",d.style.zIndex=this.config.iframeZIndex,d.style.left="0",d.style.top="0",d.style.width="100%",d.style.height="100%",d.style.backgroundColor=this.config.popupBackgroundColor,this.config.inFullscreenMode=!0}},{key:"show",value:function(){var t=this;document.getElementById(u)?this._show():(d.src=this.getIframeSrc(),d.id=u,d.style.width=0,d.style.height=0,d.frameBorder="0",d.onload=function(){var e=new CustomEvent("load");t.dispatcher.dispatchEvent(e)},this._show(),document.body.appendChild(d))}}]),e}());t.exports=p},{"../package.json":4,"./supports":5,"./xlapi":6,"to-snake-case":2}]},{},["main"])("main")});
//# sourceMappingURL=xl.min.js.map
